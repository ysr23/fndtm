<%- model_class = Task -%>
<div class="page-header">
  <%  if params[:on].present? 
        @day_to_view = params[:on].to_date 
  else
    @day_to_view = Date.today
  end
%>
<h1><%= link_to "<i class='icon-circle-arrow-left'></i>".html_safe, tasks_path(:on => @day_to_view - 1.day) %>
<%=t '.title', :default => @day_to_view.strftime('%a %d %b')  %>
<%= link_to "<i class='icon-circle-arrow-right'></i>".html_safe, tasks_path(:on => @day_to_view + 1.day) %> 
<%= link_to "<i class='icon-plus-sign'></i> ".html_safe, new_task_path(:on => @day_to_view), :remote => true %> 
</h1>
</div>
  <table class="table table-hover table-striped table-condensed" >
  <tbody id="tasksTable" >
    <%if @all_tasks.count > 0 %>
      <% @all_tasks.each do |task| %>
        <% if task.completed? %>
          <% @class_status="success complete" %>
        <% elsif task.task_start < Date.today  %>
          <% @class_status="error" %>
        <% elsif %>
          <% @class_status="" %>
        <% end %>
        <% @task_instance = task %>
        <%= render partial: "task", :locals => { :task => task } %>
      <% end %>
    <% else %>
      <tr>
      </tr>
    <% end %>
  </tbody>
</table>

<% content_for :sideb do %>
  <li class="nav-header">Upcoming</li>
  <table id="tasksTable" class="table table-striped table-condensed">
    <tbody>
      <% @upcoming_tasks.last(5).sort {|a,b| a.task_start <=> b.task_start}.each_with_index do |task| %>
        <tr>
          <td>
            <div id="complete_icon_<%= task.id %>">
              <% if task.completed%> 
                <%= render 'set_uncomplete', :task => task, :size => "icon-2x" %>
              <% else %> 
                <%= render 'set_complete', :task => task, :size => "icon-2x" %> 
              <% end %> 
            </div>
          </td>
          <td><%= link_to task.name, task_path(task) %></td>
          <td><%= distance_of_time_in_words_to_now(task.task_start.to_datetime) + " from now"if task.task_start %></td>
        </tr>
      <% end %>
    </tbody>
  </table>


  <li class="nav-header">Recently Complete</li>
  <table id="RH_completed" class="table table-striped table-condensed complete">
    <tbody>
      <% @completed_tasks.last(5).sort {|a,b| b.completed_at <=> a.completed_at}.each_with_index do |task| %>
        <tr>
          <td>
            <div id="complete_icon_<%= task.id %>">
              <% if task.completed%> 
                <%= render 'set_uncomplete', :task => task, :size => "icon-2x" %>
              <% else %> 
                <%= render 'set_complete', :task => task, :size => "icon-2x" %> 
              <% end %> 
            </div>
          </td>
          <td><%= link_to task.name, task_path(task) %></td>
          <td><%= time_ago_in_words(task.completed_at) + " ago" %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% end%>
